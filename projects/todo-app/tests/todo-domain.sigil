t Todo={id:â„¤,text:ğ•Š,done:ğ”¹}

i srcâ‹…todo-domain
i stdlibâ‹…numeric

Î»lenTodos(todos:[Todo])â†’â„¤â‰¡todos{
  []â†’0|
  [_,.rest]â†’1+lenTodos(rest)
}

Î»main()â†’ğ•Œ=()

test "todo add prepends item" {
  â‰¡srcâ‹…todo-domain.addTodo([],1,"Task"){
    [todo]â†’todo.id=1âˆ§todo.text="Task"âˆ§todo.done=âŠ¥|
    _â†’âŠ¥
  }
}

test "todo clearCompleted keeps active only" {
  â‰¡srcâ‹…todo-domain.clearCompleted([Todo{id:1,text:"A",done:âŠ¤},Todo{id:2,text:"B",done:âŠ¥}]){
    [todo]â†’todo.id=2âˆ§todo.done=âŠ¥|
    _â†’âŠ¥
  }
}

test "todo completedCount counts completed" {
  srcâ‹…todo-domain.completedCount([Todo{id:1,text:"A",done:âŠ¤},Todo{id:2,text:"B",done:âŠ¥},Todo{id:3,text:"C",done:âŠ¤}])=2
}

test "todo completedCount result can use numeric predicates" {
  l count=srcâ‹…todo-domain.completedCount([Todo{id:1,text:"A",done:âŠ¤},Todo{id:2,text:"B",done:âŠ¥},Todo{id:3,text:"C",done:âŠ¤}]);
  stdlibâ‹…numeric.is_even(count)=âŠ¤âˆ§stdlibâ‹…numeric.in_range(count,0,3)=âŠ¤
}

test "todo delete reduces length" {
  lenTodos(srcâ‹…todo-domain.deleteTodo([Todo{id:1,text:"A",done:âŠ¥},Todo{id:2,text:"B",done:âŠ¥}],1))=1
}

test "todo delete removes target" {
  â‰¡srcâ‹…todo-domain.deleteTodo([Todo{id:1,text:"A",done:âŠ¥},Todo{id:2,text:"B",done:âŠ¥}],1){
    [todo]â†’todo.id=2âˆ§todo.text="B"|
    _â†’âŠ¥
  }
}

test "todo edit updates text" {
  srcâ‹…todo-domain.editTodo([Todo{id:1,text:"Old",done:âŠ¥}],1,"New")[0].text="New"
}

test "todo toggle flips done flag" {
  srcâ‹…todo-domain.toggleTodo([Todo{id:1,text:"Task",done:âŠ¥}],1)[0].done=âŠ¤
}
